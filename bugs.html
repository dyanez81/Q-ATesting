<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Bugs - QA Finsus</title>

    <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }

        .main-content {
            margin-left: 230px;
            padding: 20px;
        }

        .status-badge {
            font-size: 0.9rem;
            padding: 6px 10px;
            border-radius: 10px;
        }

        .filter-bar {
            background: white;
            border-radius: 12px;
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-bar select {
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div id="navbarContainer"></div>

    <div class="main-content">
        <div class="container-fluid mt-4 mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="text-start" style="color:#23223F;">üêû Seguimiento de Bugs</h3>
            </div>

            <!-- üîπ Filtros -->
            <div class="filter-bar d-flex flex-wrap align-items-center gap-3 mb-4">
                <div>
                    <label class="form-label fw-semibold mb-0">Estatus:</label>
                    <select id="filterStatus" class="form-select form-select-sm">
                        <option value="Todos">Todos</option>
                        <option>Abierto</option>
                        <option>En progreso</option>
                        <option>Resuelto</option>
                        <option>Rechazado</option>
                    </select>
                </div>

                <div>
                    <label class="form-label fw-semibold mb-0">Asignado a:</label>
                    <input type="text" id="filterAssignee" class="form-control-sm" placeholder="ej. dev@finsus.com">
                </div>
                <button id="applyFilters" class="btn btn-dark btn-sm">üîç Aplicar</button>
            </div>

            <!-- üîπ Tabla de Bugs -->
            <div class="card shadow p-3">
                <table class="table table-striped align-middle" id="bugsTable">
                    <thead style="background:#23223F; color:white;">
                        <tr>
                            <th>T√≠tulo</th>
                            <th>Descripci√≥n</th>
                            <th>Estatus</th>
                            <th>Asignado a</th>
                            <th>Reportado por</th>
                            <th>Caso</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- üß© Modal de Detalle del Bug (timeline de comentarios) -->
    <div class="modal fade" id="bugDetailModal" tabindex="-1" aria-labelledby="bugDetailLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px;">
                <div class="modal-header" style="background-color:#23223F; color:white;">
                    <h5 class="modal-title fw-semibold" id="bugDetailLabel">üêû Detalle del Bug</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div id="bugDetailInfo" class="mb-3"></div>

                    <h6 class="fw-semibold mt-3">üí¨ Historial de comentarios</h6>
                    <div id="bugHistory" class="border rounded p-3 mb-3 bg-light"
                        style="max-height: 300px; overflow-y: auto;">
                        <p class="text-muted text-center">Sin comentarios registrados</p>
                    </div>

                    <form id="commentForm" class="d-flex gap-2">
                        <input type="text" id="commentText" class="form-control" placeholder="Agregar comentario..."
                            required>
                        <button type="submit" class="btn btn-dark">Enviar</button>
                    </form>
                </div>

                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- üîß Scripts -->
    <script type="module">
        import { loadNavbar } from './js/ui.js';
        import { auth, db } from './js/firebase-config.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js';
        import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js';
        import { logout } from './js/auth.js';

        await loadNavbar();

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const ref = doc(db, 'users', user.uid);
                const snap = await getDoc(ref);
                if (snap.exists()) {
                    const data = snap.data();
                    document.getElementById('userName').textContent = data.name || user.email;
                    document.getElementById('userRole').textContent = data.role || 'Tester';
                }
            }
        });

        window.logout = logout;
    </script>

    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./js/bugs.js"></script>
</body>

</html>